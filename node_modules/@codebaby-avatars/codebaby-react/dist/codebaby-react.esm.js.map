{"version":3,"file":"codebaby-react.esm.js","sources":["../src/utils/events.js","../src/utils/normalizeEventName.js","../src/hooks/useLoadLib.js","../src/context/avatarCtx.js","../src/components/AvatarProvider.jsx","../src/hooks/useCodebabyEvents.js","../src/hooks/useIsInitialized.js"],"sourcesContent":["const events = {\r\n\ttansformEventName(name) {\r\n\t\tif(this.types[name]) {\r\n\t\t\treturn this.types[name];\r\n\t\t} else {\r\n\t\t\treturn name;\r\n\t\t}\r\n\t},\r\n\ttypes: {\r\n\t\task: 'na-ask.vidbaby',\r\n\t\tinitialized: 'na-initialized.vidbaby',\r\n\t\tplayResponseData: 'na-playResponseData.vidbaby',\r\n\t\tresponse: 'na-response.vidbaby',\r\n\t\tplayResponse: 'na-playResponse.vidbaby',\r\n\t\tmicrophoneStarted: 'na-microphoneStarted.vidbaby',\r\n\t\tmicrophoneAudio: 'na-microphoneAudio.vidbaby',\r\n\t\tmicrophoneData: 'na-microphoneData.vidbaby',\r\n\t\tmicrophoneStop: 'na-microphoneStop.vidbaby',\r\n\t\tmicrophoneStopped: 'na-microphoneStopped.vidbaby',\r\n\t\tplayerBuilt: 'na-playerBuilt.vidbaby',\r\n\t\tunPark: 'na-unPark.vidbaby',\r\n\t\tsegmentEnded: 'na-segmentEnded.vidbaby',\r\n\t\tclientData: 'na-clientData.vidbaby',\r\n\t\textractedEntity: 'na-extractedEntity.vidbaby',\r\n\t\tplay: 'na-play.vidbaby',\r\n\t\tpause: 'na-pause.vidbaby',\r\n\t\tmute: 'na-mute.vidbaby',\r\n\t\tunmute: 'na-unmute.vidbaby',\r\n\t\t'player:state': 'na-player:state.vidbaby',\r\n\t\tpreRender: 'na-preRender.vidbaby',\r\n\t\tinterimPlayResponse: 'na-interimPlayResponse.vidbaby',\r\n\t\tinterimResponse: 'na-interimResponse.vidbaby',\r\n\t\tinterimSegmentEnded: 'na-interimSegmentEnded.vidbaby',\r\n\t\tplayerLoadingAssets: 'na-playerLoadingAssets.vidbaby',\r\n\t\t'record-start': 'na-record-start.vidbaby',\r\n\t\t'record-stop': 'na-record-stop.vidbaby',\r\n\t\t'video-progress': 'na-video-progress.vidbaby',\r\n\t\t'video-converted': 'na-video-converted.vidbaby',\r\n\t\t'video-ready': 'na-video-ready.vidbaby',\r\n\t\t'video-cancel': 'na-video-cancel.vidbaby',\r\n\t\tcamChange: 'na-camChange.vidbaby',\r\n\t\tglbLoaded: 'na-glbLoaded.vidbaby'\r\n\t}\r\n}\r\n\r\nexport default events;","import events from \"./events\";\r\n\r\nfunction normalizeEventName(eventName) {\r\n  const kebabCase = eventName.replace(/([A-Z])/g, g => `-${g[0].toLowerCase()}`);\r\n  return Object.keys(events.types).includes(kebabCase) ? kebabCase : eventName;\r\n}\r\n\r\nexport default normalizeEventName;","import { useLayoutEffect, useState } from \"react\";\r\n\r\nconst loadScript = ({ src, type = 'module', async = true }) => new Promise((resolve, reject) => {\r\n  const script = document.createElement(\"script\");\r\n  script.src = src;\r\n  script.type = type;\r\n  script.async = async;\r\n  script.onload = () => resolve(script);\r\n  script.onerror = () => reject(new Error('Failed to load script. Check your internet connection.'));\r\n  document.head.appendChild(script);\r\n});\r\n\r\nasync function jqVerHandling(){\r\n  if(typeof window.jQuery === 'undefined'\r\n    || typeof window.$ != 'function'\r\n    || window.jQuery.fn.jquery === undefined\r\n    || window.jQuery.fn.jquery < '3.4.1') {\r\n    let siteJq = null;\r\n    let site$ = null;\r\n    if (typeof window.jQuery != 'undefined'){\r\n      siteJq = window.jQuery\r\n      site$ = window.$\r\n    }\r\n    await loadScript({ \r\n      src: 'https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js',\r\n      type: 'text/javascript',\r\n      async: false\r\n    });\r\n    window.vidbaby$ = window.$;\r\n    if(siteJq){\r\n      window.$ = site$;\r\n      window.jQuery = siteJq;\r\n    }\r\n  } else {\r\n    window.vidbaby$ = window.$;\r\n  }\r\n\r\n  if(typeof window.$ === 'undefined') {\r\n    window.$ = window.jQuery;\r\n  }\r\n  return;\r\n}\r\n\r\nfunction useLoadCodebaby({ id, env }) {\r\n  const [getVB, setVB] = useState();\r\n  \r\n  useLayoutEffect(() => {\r\n    const verify = async () => {\r\n      const environments = {\r\n        local: `http://localhost:8080/loader.js?id=${id}&env=local`,\r\n        dev: `https://bridge3-dev.codebaby.com/loader.js?id=${id}&env=dev`,\r\n        qa: `https://qa-avatar.n-avatars.com/loader.js?id=${id}&env=qa`,\r\n        default: `https://portal.codebaby.com/loader.js?id=${id}`,\r\n      };\r\n\r\n      const normalizedEnv = (typeof env === 'string' ? env : '').toLowerCase().replace('localhost', 'local');\r\n      const url = environments[normalizedEnv] || environments.default;\r\n      \r\n      await jqVerHandling();\r\n      await loadScript({ src: url });\r\n      setVB(() => window.vidbaby$)\r\n    };\r\n    \r\n    if (window) {\r\n      verify()\r\n    } else {\r\n      setTimeout(verify, 3000);\r\n    }\r\n  }, []);  \r\n\r\n  return getVB;\r\n};\r\n\r\nexport default useLoadCodebaby;","import { createContext } from \"react\";\r\n\r\nconst avatarCtx = createContext({\r\n  on(event, cb) {},\r\n\toff(event, cb) {},\r\n\ttrigger(event, data){},\r\n});\r\n\r\nexport default avatarCtx;","import React, { \r\n  useCallback,\r\n  Fragment,\r\n  forwardRef,\r\n  useMemo,\r\n  useImperativeHandle,\r\n  useEffect\r\n} from \"react\";\r\n\r\nimport events from \"../utils/events\";\r\nimport normalizeEventName from \"../utils/normalizeEventName\";\r\n\r\nimport useLoadCodebaby from \"../hooks/useLoadLib\";\r\nimport avatarCtx from \"../context/avatarCtx\";\r\n\r\nconst AvatarProvider = forwardRef(function RefAvatarProvider({ children, id, env, ...onFunctions }, ref) {\r\n  const vidbaby$ = useLoadCodebaby({ id, env });\r\n\r\n  const onCodebaby = useCallback((event, cb) => {\r\n    if(vidbaby$)\r\n      vidbaby$(document).on(events.tansformEventName(event), cb);\r\n    }, [vidbaby$]);\r\n    const offCodebaby = useCallback((event, cb) => {\r\n      if(vidbaby$)\r\n      vidbaby$(document).off(events.tansformEventName(event), cb);\r\n    }, [vidbaby$]);\r\n    const triggerCodebaby = useCallback((event, data) => {\r\n      if(vidbaby$)\r\n        vidbaby$(document).trigger(events.tansformEventName(event), data);\r\n  }, [vidbaby$]);\r\n\r\n  const eventHandler = useMemo(() => ({\r\n    on: onCodebaby,\r\n    off: offCodebaby,\r\n    trigger: triggerCodebaby,\r\n  }), [onCodebaby, offCodebaby, triggerCodebaby]);\r\n\r\n  useImperativeHandle(ref, function refEvents() {\r\n    return eventHandler;\r\n  }, [eventHandler]);\r\n\r\n  useEffect(() => {\r\n    if(!vidbaby$ || !onFunctions || Object.keys(onFunctions).length === 0)\r\n      return;\r\n    const fns = onFunctions;\r\n    const eventsName = Object.keys(onFunctions)\r\n      .filter(i => i.startsWith(\"on\"))\r\n      .map(i => i.replace(\"on\", \"\"))\r\n      .map(i => i.charAt(0).toLowerCase() + i.slice(1));\r\n\r\n    if(eventsName.length <= 0)\r\n      return;\r\n    for(const eventName of eventsName) {\r\n      const key = `on${eventName.charAt(0).toUpperCase() + eventName.slice(1)}`;\r\n      if(eventName == 'initialized') {\r\n        eventHandler.on(normalizeEventName(eventName), (...args) => {\r\n          setTimeout(() => fns[key].apply(null, ...args), 1700);\r\n        });\r\n      } else {\r\n        eventHandler.on(normalizeEventName(eventName), fns[key]);\r\n      }\r\n    };\r\n    return () => {\r\n      for(const eventName of eventsName) {\r\n        const key = `on${eventName.charAt(0).toUpperCase() + eventName.slice(1)}`;\r\n        eventHandler.off(normalizeEventName(eventName), fns[key]);\r\n      };\r\n    };\r\n  }, [onFunctions, vidbaby$]);\r\n\r\n  return (\r\n    <avatarCtx.Provider value={eventHandler}>\r\n      <Fragment>\r\n        {children}\r\n        <div id=\"avatarContainer\" className=\"codebaby-react-avatar-container\"></div>\r\n      </Fragment>\r\n    </avatarCtx.Provider>\r\n  );\r\n});\r\n\r\n\r\nexport {AvatarProvider};","import { useContext } from \"react\";\r\nimport avatarCtx from \"../context/avatarCtx\";\r\n\r\nfunction useCodebabyEvents() {\r\n  const { on, off, trigger } = useContext(avatarCtx);\r\n\r\n  return { on, off, trigger };\r\n};\r\n\r\nexport {useCodebabyEvents};","import { useEffect, useState } from 'react';\r\n\r\nfunction useIsInitialized() {\r\n  const [isInitialized, setIsInitialized] = useState(false);\r\n\r\n  useEffect(() => {\r\n    let timeoutId = null;\r\n    const verify = () => {\r\n      if(window) {\r\n        if(window.vidbaby$ && window.vidbaby && window.vidbaby.initialized) {\r\n          return setIsInitialized(true);\r\n        }\r\n      }\r\n      timeoutId = setTimeout(verify, 1000);\r\n    };\r\n    verify();\r\n    return () => {\r\n      if(timeoutId)\r\n        clearTimeout(timeoutId);\r\n    };\r\n  }, []);\r\n\r\n  return isInitialized;\r\n}\r\n\r\nexport {useIsInitialized};"],"names":["React","useState","useLayoutEffect","createContext","forwardRef","useCallback","useMemo","useImperativeHandle","useEffect","Fragment","useContext","events","name","events$1","normalizeEventName","eventName","kebabCase","g","loadScript","src","type","async","resolve","reject","script","jqVerHandling","siteJq","site$","useLoadCodebaby","id","env","getVB","setVB","verify","environments","normalizedEnv","url","avatarCtx","event","cb","data","avatarCtx$1","AvatarProvider","children","onFunctions","ref","vidbaby$","onCodebaby","offCodebaby","triggerCodebaby","eventHandler","fns","eventsName","i","key","args","useCodebabyEvents","on","off","trigger","useIsInitialized","isInitialized","setIsInitialized","timeoutId"],"mappings":"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"}